<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" width="955" height="600" xmlns:local="*"
			    creationComplete="application1_creationCompleteHandler(event)" mouseUp="globalMouseUp(event)">
	
	<fx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			private var currentInstrument:String = "";
			
			public var rb:SquareGrid = MapEditor.drawRb();
			
			protected function updateDimBtn_clickHandler(event:MouseEvent):void
			{

				squareGrid = new SquareGrid();
				squareGrid.init(parseInt(gridWidth.text), parseInt(gridHeight.text));
				
				scroller.viewport = squareGrid;
				
			}
			
			protected function application1_creationCompleteHandler(event:FlexEvent):void
			{
				// TODO Auto-generated method stub
				squareGrid.initWithTooltip(25,25);
				gridWidth.text = "25";
				gridHeight.text = "25";
				
				rbGroup.addElement(MapEditor.drawRb());
				//roundAbout.initWithTooltip(10,10, false);
				//drawRb(roundAbout);
				
			}
			
			protected function onInstrumentSelect(event:MouseEvent):void
			{
				switch(event.currentTarget.id){
					case "eraserInstr":
						trace('sel eraser');
						break;
					case "roadInstr":
						trace('sel road');
						break;
				}
			}
			
			protected function globalMouseUp(event:MouseEvent):void
			{
				squareGrid.mouseUp();
			}
			
			public static function drawRb():SquareGrid{
				var grid:SquareGrid = new SquareGrid();
				grid.initWithTooltip(10,10, false);
				
				grid.cells[0][3].type = Cell.ROAD;
				grid.cells[0][4].type = Cell.ROAD;
				grid.cells[0][5].type = Cell.ROAD;
				grid.cells[0][6].type = Cell.ROAD;
				
				grid.cells[2][1].type = Cell.ROAD;
				grid.cells[2][2].type = Cell.ROAD;
				grid.cells[2][3].type = Cell.ROAD;
				grid.cells[2][6].type = Cell.ROAD;
				grid.cells[2][7].type = Cell.ROAD;
				grid.cells[2][8].type = Cell.ROAD;
				
				grid.cells[3][0].type = Cell.ROAD;
				grid.cells[3][1].type = Cell.ROAD;
				grid.cells[3][2].type = Cell.ROAD;
				grid.cells[3][7].type = Cell.ROAD;
				grid.cells[3][8].type = Cell.ROAD;
				grid.cells[3][9].type = Cell.ROAD;
				
				grid.cells[4][0].type = Cell.ROAD;
				grid.cells[4][1].type = Cell.ROAD;
				grid.cells[4][8].type = Cell.ROAD;
				grid.cells[4][9].type = Cell.ROAD;
				
				grid.cells[5][0].type = Cell.ROAD;
				grid.cells[5][1].type = Cell.ROAD;
				grid.cells[5][8].type = Cell.ROAD;
				grid.cells[5][9].type = Cell.ROAD;
				
				grid.cells[6][0].type = Cell.ROAD;
				grid.cells[6][1].type = Cell.ROAD;
				grid.cells[6][2].type = Cell.ROAD;
				grid.cells[6][7].type = Cell.ROAD;
				grid.cells[6][8].type = Cell.ROAD;
				grid.cells[6][9].type = Cell.ROAD;
				
				grid.cells[7][1].type = Cell.ROAD;
				grid.cells[7][2].type = Cell.ROAD;
				grid.cells[7][3].type = Cell.ROAD;
				grid.cells[7][6].type = Cell.ROAD;
				grid.cells[7][7].type = Cell.ROAD;
				grid.cells[7][8].type = Cell.ROAD;
				
				grid.cells[9][3].type = Cell.ROAD;
				grid.cells[9][4].type = Cell.ROAD;
				grid.cells[9][5].type = Cell.ROAD;
				grid.cells[9][6].type = Cell.ROAD;
				
				for (var i:int = 2; i<8; i++){
					grid.cells[1][i].type = Cell.ROAD;
					grid.cells[8][i].type = Cell.ROAD;
				}
				
				return grid;
				
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<s:HGroup paddingTop="10" paddingLeft="10">
		<s:Scroller id="scroller" width="501" height="551">
			<local:SquareGrid id="squareGrid" />
		</s:Scroller>

		<s:VGroup>
			<s:HGroup verticalAlign="middle">
				<s:Label text="Width:"/>
				<s:TextInput id="gridWidth" width="50" />
				<s:Label text="Height:"/>
				<s:TextInput id="gridHeight" width="50" />
				<s:Button label="Update" id="updateDimBtn" click="updateDimBtn_clickHandler(event)" />
			</s:HGroup>
			<s:Button label="Save as..."/>
			
			<s:Label text="Instruments" fontSize="18"/>
			<s:HGroup id="roadInstr" useHandCursor="true" click="onInstrumentSelect(event)">
				<s:Rect width="20" height="20" fill="{SquareCell.roadFill}" stroke="{SquareCell.defaultStroke}"/>
				<s:Label text="Road"/>
			</s:HGroup>
			<s:HGroup id="eraserInstr" useHandCursor="true" click="onInstrumentSelect(event)">
				<s:Rect width="20" height="20" fill="{SquareCell.defaultFill}" stroke="{SquareCell.defaultStroke}"/>
				<s:Label text="Eraser"/>
			</s:HGroup>
			
			<s:VGroup id="rbGroup">
				<s:Label text="Roundabout" fontSize="18"/>
				<local:SquareGrid id="roundAbout" />
			</s:VGroup>
			
			<s:TextArea id="log"/>
			
		</s:VGroup>
		
		
	</s:HGroup>
	
</s:Application>
